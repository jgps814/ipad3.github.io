<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互動歷史：17世紀的福爾摩沙</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Formosan Earth (福爾摩沙大地) -->
    <!-- Application Structure Plan: The SPA is designed as a multi-faceted exploration tool, not a linear report. The structure uses a top navigation bar to switch between four main thematic sections: 1. **探索時代 (Timeline Explorer)**: A dynamic dashboard where users select a time period to see how different groups interacted and how the economy changed. This is the core interactive element, promoting discovery over passive reading. 2. **關鍵影響 (Key Impacts)**: A focused, tabbed section that breaks down the complex historical impacts into five digestible themes (Politics, Economy, Society, Culture, Environment), making abstract concepts easier to grasp. 3. **歷史現場 (Historic Sites)**: A virtual tour using interactive cards to connect historical events to real-world locations, fostering a sense of place and tangible connection to the past. 4. **貿易風雲 (Trading Game)**: A simple simulation game that embodies the "learning by doing" principle from the source report, allowing students to experience the economic challenges and opportunities of the era firsthand. This structure was chosen to cater to different learning styles—exploratory, analytical, visual, and kinesthetic—making the complex history of 17th-century Taiwan accessible and engaging for 5th graders. -->
    <!-- Visualization & Content Choices: 
        - **Timeline (HTML/CSS/JS)**: Goal: Organize/Change. A custom interactive timeline acts as the primary filter for the main dashboard. Interaction: Clicking a period updates the entire section. Justification: Provides a clear chronological framework for exploration.
        - **Trade Goods Chart (Chart.js Bar Chart)**: Goal: Compare/Change. Shows the relative importance of key exports (deer skin, sugar, rice). Interaction: Data updates based on the selected timeline period. Justification: Visually represents the economic core of the era and its shifts over time. Library: Chart.js for its simplicity and responsiveness.
        - **Impact Donut Charts (Chart.js Donut Chart)**: Goal: Inform. Used in the "Key Impacts" section to show simple proportions, e.g., the composition of different population groups. Interaction: Static display for quick comprehension. Justification: Breaks down complex data into simple, memorable visuals. Library: Chart.js.
        - **Perspective Cards (HTML/CSS/JS)**: Goal: Compare/Organize. Clickable cards for each major group (Dutch, Spanish, Indigenous, Han) that reveal their perspective. Interaction: Clicking a card updates a central text panel. Justification: Directly implements the report's emphasis on multi-perspective understanding.
        - **Historic Site Cards (HTML/CSS/JS)**: Goal: Organize. A grid of cards with hover and click effects. Interaction: Clicking reveals detailed information in a modal-like fashion. Justification: Creates an engaging "virtual tour" without needing a complex map library.
        - **Trading Game (HTML/CSS/JS)**: Goal: Inform/Engage (Simulation). A simple UI for a buy/sell game. Interaction: Users click buttons to trade and react to random events. Justification: A direct, gamified implementation of the report's teaching strategies, making economic concepts tangible.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFBF5; /* Warm Neutral Background */
            color: #4A4A4A;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .nav-link {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active, .nav-link:hover {
            border-bottom-color: #D4A373; /* Accent Color */
            color: #A97C50;
        }
        .btn-primary {
            background-color: #A97C50; /* Muted Green/Brown */
            color: #FFFFFF;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #8C663F;
        }
        .card {
            background-color: #FFFFFF;
            border: 1px solid #EAEAEA;
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .tab-button.active {
            background-color: #D4A373;
            color: white;
        }
        .perspective-btn.active {
            background-color: #D4A373;
            color: white;
            transform: scale(1.05);
        }
        .timeline-segment.active {
            background-color: #A97C50;
        }
        .timeline-segment.active .timeline-year {
            color: white;
        }
        .timeline-segment.active .timeline-label {
            color: #FDFBF5;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-[#A97C50]">🚢 17世紀的福爾摩沙</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#explore" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700">探索時代</a>
                        <a href="#impacts" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700">關鍵影響</a>
                        <a href="#sites" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700">歷史現場</a>
                        <a href="#game" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700">貿易風雲</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-[#D4A373]">
                        <span class="sr-only">Open main menu</span>
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                        </svg>
                    </button>
                </div>
            </div>
        </nav>
        <div id="mobile-menu" class="md:hidden hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#explore" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700">探索時代</a>
                <a href="#impacts" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700">關鍵影響</a>
                <a href="#sites" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700">歷史現場</a>
                <a href="#game" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700">貿易風雲</a>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <section id="explore" class="page-section pt-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">探索時代：多方勢力的交會</h2>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600">十七世紀的臺灣是世界舞台的縮影。點擊下方的時間軸，看看不同時期，各方勢力如何在福爾摩沙這片土地上互動、競爭與合作，共同形塑了臺灣的早期歷史。</p>
            </div>

            <div id="timeline" class="flex flex-col md:flex-row justify-center items-center gap-0 mb-12"></div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                <div class="lg:col-span-1 flex flex-col gap-4">
                    <h3 class="text-xl font-bold text-center">誰的時代？點擊來看</h3>
                    <div id="perspective-buttons" class="grid grid-cols-2 gap-4"></div>
                    <div id="perspective-content" class="p-6 rounded-lg bg-white shadow-md min-h-[200px]">
                        <h4 id="perspective-title" class="font-bold text-lg mb-2 text-[#A97C50]"></h4>
                        <p id="perspective-text" class="text-gray-700"></p>
                    </div>
                </div>
                <div class="lg:col-span-2">
                    <h3 class="text-xl font-bold text-center mb-4">貿易造就的榮景與代價</h3>
                    <p class="text-center text-gray-600 mb-4">鹿皮與蔗糖是當時最重要的出口商品，為荷蘭東印度公司帶來巨大利潤，卻也深刻改變了臺灣的生態與社會。</p>
                    <div class="chart-container bg-white p-4 rounded-lg shadow-md">
                        <canvas id="tradeChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="impacts" class="page-section pt-16 hidden">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">關鍵影響：歷史留下的印記</h2>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600">歐洲人的到來，像一顆投入池塘的石子，激起的漣漪擴及政治、經濟、社會、文化與環境等各個層面，其影響至今仍在。</p>
            </div>
            <div class="max-w-4xl mx-auto">
                <div id="impact-tabs" class="mb-4 flex flex-wrap justify-center gap-2"></div>
                <div id="impact-content" class="p-6 rounded-lg bg-white shadow-md min-h-[300px]">
                    <h3 id="impact-title" class="text-2xl font-bold mb-4 text-[#A97C50]"></h3>
                    <p id="impact-text" class="text-gray-700 leading-relaxed"></p>
                </div>
            </div>
        </section>

        <section id="sites" class="page-section pt-16 hidden">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">歷史現場：走進時光隧道</h2>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600">從臺南到淡水，歐洲人留下的城堡與遺址，是臺灣步入世界史的見證。點擊卡片，來一場跨越時空的虛擬旅行吧！</p>
            </div>
            <div id="sites-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </section>

        <section id="game" class="page-section pt-16 hidden">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">貿易風雲：體驗商館經營</h2>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-600">想體驗17世紀的貿易挑戰嗎？你現在是荷蘭東印度公司的一位商人，目標是在一年內賺取最大利潤。注意市場價格波動和突發事件！</p>
            </div>
            <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg shadow-lg">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 text-center">
                    <div>
                        <p class="text-sm text-gray-500">月份</p>
                        <p id="game-month" class="text-2xl font-bold">1 / 12</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">現金</p>
                        <p id="game-cash" class="text-2xl font-bold">1000</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">總資產</p>
                        <p id="game-assets" class="text-2xl font-bold">1000</p>
                    </div>
                </div>
                <div id="game-market" class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6"></div>
                <div id="game-message-box" class="min-h-[50px] p-4 mb-6 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 rounded-md text-center">
                    <p id="game-message">歡迎來到大員！開始你的貿易之旅吧。</p>
                </div>
                <div class="text-center">
                    <button id="next-month-btn" class="btn-primary font-bold py-2 px-6 rounded-lg">前往下個月</button>
                </div>
            </div>
        </section>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const appData = {
                timeline: [
                    { id: 'period1', label: '荷西對峙', years: '1624-1642', description: '荷蘭人與西班牙人先後抵達臺灣，分別在南部與北部建立據點，開啟了臺灣的大航海時代。' },
                    { id: 'period2', label: '荷蘭獨霸', years: '1642-1662', description: '荷蘭人驅逐西班牙人後，成為臺灣唯一的歐洲統治勢力，積極發展貿易與農業。' },
                    { id: 'period3', label: '明鄭時期', years: '1662-1683', description: '鄭成功驅逐荷蘭人，臺灣進入漢人政權統治時期，並引入儒家文化。' }
                ],
                perspectives: {
                    dutch: { title: '🇳🇱 荷蘭人', text: '我們是荷蘭東印度公司(VOC)，來臺灣是為了建立與中國、日本貿易的據點。臺灣的鹿皮和蔗糖能為我們帶來巨大財富，但管理原住民和漢人移民是個挑戰。' },
                    spanish: { title: '🇪� 西班牙人', text: '我們的目標是從呂宋島向北擴張，對抗荷蘭的勢力，並向此地的原住民傳播天主教的福音。我們在北臺灣建立了聖薩爾瓦多城。' },
                    indigenous: { title: '🏹 原住民族', text: '我們是這片土地最早的主人。外來者帶來了新的商品和宗教，但也奪走了我們的獵場和土地。我們有時與他們合作，有時則奮力反抗。' },
                    han: { title: '農 漢人移民', text: '我們從動亂的中國大陸來到這裡尋求新的生活。我們為荷蘭人開墾土地、種植甘蔗，也從事各種商業活動，逐漸形成自己的社群。' }
                },
                tradeData: {
                    period1: { labels: ['鹿皮', '蔗糖', '稻米'], data: [80, 40, 20] },
                    period2: { labels: ['鹿皮', '蔗糖', '稻米'], data: [60, 90, 50] },
                    period3: { labels: ['鹿皮', '蔗糖', '稻米'], data: [30, 70, 80] }
                },
                impacts: {
                    politics: { title: '政治：現代治理的雛形', text: '荷蘭人建立了議會、法庭等機構，是臺灣第一個現代化治理的開端。他們透過武力與契約，將原住民部落納入其統治體系，但也引入了土地買賣制度，衝擊了原住民原有的土地概念。' },
                    economy: { title: '經濟：躍上世界貿易舞台', text: '臺灣成為荷蘭東印度公司在東亞的轉口貿易中心，鹿皮、蔗糖、稻米等商品被銷往世界各地。為發展農業，荷蘭人大量招募漢人來臺開墾，奠定了臺灣農業發展的基礎。' },
                    society: { title: '社會：多族群社會的形成', text: '大量漢人移民的到來，使臺灣首次出現原住民、歐洲人、漢人等多族群共存的社會結構。漢人社群的擴大也壓縮了原住民的生活空間，導致族群衝突時有發生。' },
                    culture: { title: '文化：新信仰與新文字', text: '歐洲傳教士傳入基督教與天主教。為了傳教，荷蘭人為西拉雅族創造了羅馬字拼音的「新港文」，這是臺灣史上第一個系統性的文字，不僅用於宗教，也用於民間的契約書寫。' },
                    environment: { title: '環境：資源開發的代價', text: '商業貿易的興盛，特別是鹿皮貿易，導致臺灣梅花鹿因被大量捕殺而數量銳減，對自然生態造成了不可逆的破壞。這是臺灣早期全球化付出的環境代價。' }
                },
                sites: [
                    { id: 'anping', name: '安平古堡', originalName: '熱蘭遮城', builder: '荷蘭人', year: 1624, location: '臺南市安平區', description: '臺灣最早的要塞，曾是荷蘭統治臺灣的政治及軍事核心。其糯米、糖漿、蚵殼灰砌成的城牆是最大特色。' },
                    { id: 'chihkan', name: '赤崁樓', originalName: '普羅民遮城', builder: '荷蘭人', year: 1653, location: '臺南市中西區', description: '作為行政與商業中心而建。鄭成功來臺後，將此地改為承天府，成為當時的最高行政機關。' },
                    { id: 'hongmao', name: '紅毛城', originalName: '聖多明哥城', builder: '西班牙/荷蘭', year: '1628/1644', location: '新北市淡水區', description: '最初由西班牙人建造，後由荷蘭人重建。因漢人稱荷蘭人為「紅毛」而得名，是臺灣現存最古老的完整西式建築。' },
                    { id: 'heping', name: '和平島遺址', originalName: '聖薩爾瓦多城', builder: '西班牙人', year: 1626, location: '基隆市和平島', description: '西班牙人在北臺灣的拓殖據點，與南部的熱蘭遮城遙遙相對。考古發現了教堂、墓葬等重要遺跡。' }
                ],
                game: {
                    goods: [
                        { id: 'deerskin', name: '鹿皮', basePrice: 50, stock: 0 },
                        { id: 'sugar', name: '蔗糖', basePrice: 30, stock: 0 },
                        { id: 'silk', name: '絲綢', basePrice: 80, stock: 0 },
                        { id: 'spice', name: '香料', basePrice: 100, stock: 0 },
                    ],
                    events: [
                        { message: '颱風來襲，所有商品價格上漲！', effect: 1.2 },
                        { message: '原住民反抗，鹿皮供應減少，價格飆升！', good: 'deerskin', effect: 1.5 },
                        { message: '與中國貿易順暢，絲綢大量湧入，價格下跌。', good: 'silk', effect: 0.7 },
                        { message: '豐收之年，蔗糖產量大增，價格便宜。', good: 'sugar', effect: 0.8 },
                        { message: '海盜猖獗，貿易受阻，香料價格大漲。', good: 'spice', effect: 1.4 },
                        { message: '市場平穩，無事發生。', effect: 1.0 }
                    ]
                }
            };

            let currentState = {
                activeSection: 'explore',
                activeTimeline: 'period1',
                activePerspective: 'dutch',
                activeImpact: 'politics',
                game: {
                    month: 1,
                    cash: 1000,
                    goods: {}
                }
            };
            
            const tradeChartInstance = null;

            function init() {
                setupNav();
                setupTimeline();
                setupPerspectiveButtons();
                setupImpactTabs();
                setupSitesGrid();
                initGame();
                updateView();
            }
            
            function setupNav() {
                const navLinks = document.querySelectorAll('.nav-link');
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');

                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const sectionId = new URL(link.href).hash.substring(1);
                        currentState.activeSection = sectionId;
                        updateView();
                        if (!mobileMenu.classList.contains('hidden')) {
                            mobileMenu.classList.add('hidden');
                        }
                    });
                });
                
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }

            function setupTimeline() {
                const timelineContainer = document.getElementById('timeline');
                timelineContainer.innerHTML = appData.timeline.map((period, index) => `
                    <div class="timeline-segment cursor-pointer flex-1 text-center p-4 transition-all duration-300 ${index < appData.timeline.length - 1 ? 'md:border-r-2 border-gray-300' : ''}" data-id="${period.id}">
                        <div class="timeline-year font-bold text-lg text-[#A97C50]">${period.years}</div>
                        <div class="timeline-label text-sm text-gray-600">${period.label}</div>
                    </div>
                `).join('');
                timelineContainer.querySelectorAll('.timeline-segment').forEach(seg => {
                    seg.addEventListener('click', () => {
                        currentState.activeTimeline = seg.dataset.id;
                        updateView();
                    });
                });
            }

            function setupPerspectiveButtons() {
                const container = document.getElementById('perspective-buttons');
                container.innerHTML = Object.keys(appData.perspectives).map(key => {
                    const p = appData.perspectives[key];
                    return `<button class="perspective-btn p-4 rounded-lg shadow-sm transition-all duration-300 bg-white" data-id="${key}">${p.title}</button>`;
                }).join('');
                container.querySelectorAll('.perspective-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        currentState.activePerspective = btn.dataset.id;
                        updateView();
                    });
                });
            }
            
            function setupImpactTabs() {
                const container = document.getElementById('impact-tabs');
                container.innerHTML = Object.keys(appData.impacts).map(key => {
                    const impact = appData.impacts[key];
                    return `<button class="tab-button px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200" data-id="${key}">${impact.title.split('：')[0]}</button>`;
                }).join('');
                container.querySelectorAll('.tab-button').forEach(btn => {
                    btn.addEventListener('click', () => {
                        currentState.activeImpact = btn.dataset.id;
                        updateView();
                    });
                });
            }
            
            function setupSitesGrid() {
                const container = document.getElementById('sites-grid');
                container.innerHTML = appData.sites.map(site => `
                    <div class="card rounded-lg overflow-hidden shadow-lg">
                        <div class="p-6">
                            <h3 class="font-bold text-xl mb-2 text-[#A97C50]">${site.name}</h3>
                            <p class="text-gray-500 text-sm mb-2">${site.originalName} (${site.year})</p>
                            <p class="text-gray-700 text-base">${site.description}</p>
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <p class="text-xs text-gray-600"><strong>建立者:</strong> ${site.builder}</p>
                                <p class="text-xs text-gray-600"><strong>地點:</strong> ${site.location}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            function updateView() {
                updateNav();
                updatePageSections();
                
                if (currentState.activeSection === 'explore') {
                    updateExploreSection();
                } else if (currentState.activeSection === 'impacts') {
                    updateImpactsSection();
                } else if (currentState.activeSection === 'game') {
                    updateGameUI();
                }
            }
            
            function updateNav() {
                document.querySelectorAll('.nav-link').forEach(link => {
                    if (link.href.endsWith(`#${currentState.activeSection}`)) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }

            function updatePageSections() {
                document.querySelectorAll('.page-section').forEach(section => {
                    if (section.id === currentState.activeSection) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            function updateExploreSection() {
                document.querySelectorAll('#timeline .timeline-segment').forEach(seg => {
                    seg.classList.toggle('active', seg.dataset.id === currentState.activeTimeline);
                });
                
                document.querySelectorAll('#perspective-buttons .perspective-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.id === currentState.activePerspective);
                });

                const perspectiveData = appData.perspectives[currentState.activePerspective];
                document.getElementById('perspective-title').textContent = perspectiveData.title;
                document.getElementById('perspective-text').textContent = perspectiveData.text;

                renderTradeChart(currentState.activeTimeline);
            }

            function updateImpactsSection() {
                document.querySelectorAll('#impact-tabs .tab-button').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.id === currentState.activeImpact);
                });
                const impactData = appData.impacts[currentState.activeImpact];
                document.getElementById('impact-title').textContent = impactData.title;
                document.getElementById('impact-text').textContent = impactData.text;
            }

            let myTradeChart = null;
            function renderTradeChart(periodId) {
                const ctx = document.getElementById('tradeChart').getContext('2d');
                const chartData = appData.tradeData[periodId];
                
                if (myTradeChart) {
                    myTradeChart.destroy();
                }

                myTradeChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: chartData.labels,
                        datasets: [{
                            label: '貿易量指數',
                            data: chartData.data,
                            backgroundColor: ['#D4A373', '#A97C50', '#8C663F'],
                            borderColor: ['#C38E5F', '#986F4A', '#7B5836'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return ` ${context.dataset.label}: ${context.raw}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: '相對貿易量'
                                }
                            }
                        }
                    }
                });
            }
            
            function initGame() {
                const goods = appData.game.goods;
                goods.forEach(g => {
                    currentState.game.goods[g.id] = { stock: 0, price: g.basePrice };
                });
                document.getElementById('next-month-btn').addEventListener('click', nextMonth);
                updateGameUI();
            }

            function updateGameUI() {
                const game = currentState.game;
                document.getElementById('game-month').textContent = `${game.month} / 12`;
                document.getElementById('game-cash').textContent = `💰 ${game.cash}`;
                
                const marketContainer = document.getElementById('game-market');
                marketContainer.innerHTML = '';
                let assetValue = game.cash;

                appData.game.goods.forEach(good => {
                    const currentGood = game.goods[good.id];
                    assetValue += currentGood.stock * currentGood.price;
                    
                    marketContainer.innerHTML += `
                        <div class="p-4 border rounded-lg">
                            <h4 class="font-bold text-lg">${good.name}</h4>
                            <p class="text-sm text-gray-500 mb-2">持有: ${currentGood.stock} | 價格: ${currentGood.price}</p>
                            <div class="flex gap-2">
                                <button class="flex-1 text-sm btn-primary py-1 px-2 rounded" onclick="buyGood('${good.id}')">買入</button>
                                <button class="flex-1 text-sm bg-gray-200 text-gray-700 py-1 px-2 rounded hover:bg-gray-300" onclick="sellGood('${good.id}')">賣出</button>
                            </div>
                        </div>
                    `;
                });
                document.getElementById('game-assets').textContent = `💎 ${assetValue}`;
                
                if (game.month > 12) {
                    endGame();
                }
            }
            
            window.buyGood = function(goodId) {
                const game = currentState.game;
                const good = game.goods[goodId];
                if (game.cash >= good.price) {
                    game.cash -= good.price;
                    good.stock += 1;
                    updateGameUI();
                } else {
                    document.getElementById('game-message').textContent = '現金不足！';
                }
            }

            window.sellGood = function(goodId) {
                const game = currentState.game;
                const good = game.goods[goodId];
                if (good.stock > 0) {
                    game.cash += good.price;
                    good.stock -= 1;
                    updateGameUI();
                } else {
                    document.getElementById('game-message').textContent = '沒有庫存可以賣了！';
                }
            }
            
            function nextMonth() {
                const game = currentState.game;
                if (game.month > 12) return;
                
                game.month++;
                
                const event = appData.game.events[Math.floor(Math.random() * appData.game.events.length)];
                document.getElementById('game-message').textContent = `本月事件：${event.message}`;

                appData.game.goods.forEach(good => {
                    let priceChange = (Math.random() - 0.4) * 0.3 + 1; // Fluctuation between 0.7 and 1.3
                    if (event.good === good.id || !event.good) {
                        priceChange *= event.effect;
                    }
                    const newPrice = Math.max(5, Math.round(game.goods[good.id].price * priceChange));
                    game.goods[good.id].price = newPrice;
                });
                
                updateGameUI();
            }

            function endGame() {
                const game = currentState.game;
                const finalAssets = parseInt(document.getElementById('game-assets').textContent.replace('💎 ', ''));
                let endMessage = `遊戲結束！你的最終資產是 ${finalAssets}。`;
                if (finalAssets > 2000) {
                    endMessage += '你真是個貿易奇才！';
                } else if (finalAssets > 1000) {
                    endMessage += '不錯的成績，你成功獲利了。';
                } else {
                    endMessage += '看來經商不易，下次再努力吧！';
                }
                document.getElementById('game-message').textContent = endMessage;
                document.getElementById('next-month-btn').disabled = true;
                document.getElementById('next-month-btn').textContent = '重新開始';
                document.getElementById('next-month-btn').onclick = () => window.location.reload();
            }

            init();
        });
    </script>
</body>
</html>
�
