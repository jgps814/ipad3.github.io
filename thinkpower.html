<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>思考例程點擊探索儀表板</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; margin: 0; background: #f5f7fa; }
        .container { max-width: 1100px; margin: 20px auto; padding: 20px; background: white; border-radius: 16px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #7f8c8d; margin-bottom: 20px; }
        .controls { text-align: center; margin: 20px 0; }
        input { padding: 12px; width: 320px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { margin: 8px; padding: 12px 20px; background: #4ECDC4; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #45B7D1; }
        button.active { background: #2c3e50; }
        .chart-wrapper { position: relative; height: 420px; margin: 20px 0; }
        .chart-container { display: none; }
        .chart-container.active { display: block; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: #e74c3c; }
        .routine-item { padding: 12px; margin: 8px 0; background: #f8f9fa; border-left: 5px solid #4ECDC4; border-radius: 6px; }
        .routine-item strong { color: #2c3e50; }
        .no-data { text-align: center; color: #e74c3c; font-weight: bold; padding: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>思考例程點擊探索儀表板</h1>
        <p class="subtitle">點擊圖表區塊 → 立刻查看適用例程！</p>

        <div class="controls">
            <input type="text" id="searchInput" placeholder="搜尋例程名稱（如：回饋梯）" onkeyup="filterRoutines()">
            <br><br>
            <button class="active" onclick="showChart('doughnut')">類別分佈</button>
            <button onclick="showChart('stage')">適用階段</button>
        </div>

        <!-- 圓環圖：點擊類別 -->
        <div id="doughnut" class="chart-container active">
            <div class="chart-wrapper">
                <canvas id="doughnutCanvas"></canvas>
            </div>
        </div>

        <!-- 堆疊圖：點擊階段 -->
        <div id="stage" class="chart-container">
            <div class="chart-wrapper">
                <canvas id="stageCanvas"></canvas>
            </div>
        </div>

        <!-- 搜尋結果區 -->
        <div id="searchResults" style="margin-top:20px; display:none;">
            <h3>搜尋結果：</h3>
            <div id="resultsList"></div>
        </div>
    </div>

    <!-- 彈跳視窗 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">例程清單</h2>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // 完整資料庫
        const routines = [
            { name: "給一個拿一個", category: "投入與人互動", stage: "課中", questions: 5 },
            { name: "回饋梯", category: "投入與人互動", stage: "課中", questions: 4 },
            { name: "無領袖討論", category: "投入與人互動", stage: "課中", questions: 3 },
            { name: "SAIL：分享—提問—想法—學習", category: "投入與人互動", stage: "課中", questions: 4 },
            { name: "創造意義", category: "投入與人互動", stage: "課中", questions: 4 },
            { name: "加一", category: "投入與人互動", stage: "課中", questions: 3 },
            { name: "看—想—疑", category: "介紹及探索想法", stage: "課前", questions: 3 },
            { name: "放大", category: "介紹及探索想法", stage: "課前", questions: 3 },
            { name: "想想—疑惑—探案", category: "介紹及探索想法", stage: "課前", questions: 3 },
            { name: "筆談", category: "介紹及探索想法", stage: "課中", questions: 1 },
            { name: "3-2-1 橋接", category: "介紹及探索想法", stage: "課前後", questions: 6 },
            { name: "羅梳方位點", category: "介紹及探索想法", stage: "課中", questions: 4 },
            { name: "解釋遊戲", category: "介紹及探索想法", stage: "課中", questions: 4 },
            { name: "頭條標題", category: "統整想法", stage: "課後", questions: 1 },
            { name: "CSI：顏色、符號、圖像", category: "統整想法", stage: "課後", questions: 3 },
            { name: "列舉—排序—連結—闡述：概念圖", category: "統整想法", stage: "課後", questions: 4 },
            { name: "連結—延伸—挑戰", category: "統整想法", stage: "課後", questions: 3 },
            { name: "4C 例程", category: "統整想法", stage: "課後", questions: 4 },
            { name: "微型實驗室架構", category: "統整想法", stage: "課中", questions: 1 },
            { name: "以前我認為……現在我認為", category: "統整想法", stage: "課後", questions: 2 },
            { name: "是什麼讓你這麼說？", category: "深究想法", stage: "課中", questions: 1 },
            { name: "觀點圈", category: "深究想法", stage: "課中", questions: 1 },
            { name: "進入角色", category: "深究想法", stage: "課中", questions: 1 },
            { name: "紅燈、黃燈", category: "深究想法", stage: "課中", questions: 2 },
            { name: "主張—支持—提問", category: "深究想法", stage: "課中", questions: 3 },
            { name: "拔河", category: "深究想法", stage: "課中", questions: 3 },
            { name: "句—詞—字", category: "深究想法", stage: "課後", questions: 3 },
            { name: "問題排序", category: "投入想法探索", stage: "課中", questions: 3 },
            { name: "剝水果", category: "投入想法探索", stage: "課中", questions: 3 },
            { name: "主線一支線—隱藏故事", category: "投入想法探索", stage: "課中", questions: 3 },
            { name: "美好與真相", category: "投入想法探索", stage: "課中", questions: 2 },
            { name: "NDA: 指名—描述—行動", category: "投入想法探索", stage: "課前", questions: 3 },
            { name: "作筆記", category: "投入想法探索", stage: "課中", questions: 3 },
            { name: "預測一收集一解釋", category: "投入行動", stage: "課前", questions: 3 },
            { name: "經驗一困難一困惑+領悟", category: "投入行動", stage: "課後", questions: 3 },
            { name: "一定要", category: "投入行動", stage: "課中", questions: 2 },
            { name: "什麼?所以呢?現在要怎樣?", category: "投入行動", stage: "課後", questions: 3 },
            { name: "三個為什麼", category: "投入行動", stage: "課後", questions: 3 },
            { name: "四個如果", category: "投入行動", stage: "課中", questions: 4 }
        ];

        // 圓環圖：類別分佈
        const doughnutCtx = document.getElementById('doughnutCanvas').getContext('2d');
        const doughnutChart = new Chart(doughnutCtx, {
            type: 'doughnut',
            data: {
                labels: ["投入與人互動", "介紹及探索想法", "統整想法", "深究想法", "投入想法探索", "投入行動"],
                datasets: [{
                    data: [6, 7, 7, 8, 6, 6],
                    backgroundColor: ["#FF6B6B", "#4ECDC4", "#45B7D1", "#96CEB4", "#FECA57", "#DDA0DD"],
                    borderWidth: 3, borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                    title: { display: true, text: '點擊任一類別 → 查看例程' }
                },
                onClick: (e, elements) => {
                    if (elements[0]) {
                        const index = elements[0].index;
                        const label = doughnutChart.data.labels[index];
                        showRoutinesByCategory(label);
                    }
                }
            }
        });

        // 堆疊圖：適用階段
        const stageCtx = document.getElementById('stageCanvas').getContext('2d');
        const stageChart = new Chart(stageCtx, {
            type: 'bar',
            data: {
                labels: ["投入與人互動", "介紹及探索想法", "統整想法", "深究想法", "投入想法探索", "投入行動"],
                datasets: [
                    { label: '課前', data: [0, 4, 0, 1, 1, 1], backgroundColor: '#FF6B6B' },
                    { label: '課中', data: [6, 2, 1, 6, 5, 3], backgroundColor: '#4ECDC4' },
                    { label: '課後', data: [0, 1, 6, 1, 0, 2], backgroundColor: '#96CEB4' }
                ]
            },
            options: {
                plugins: { title: { display: true, text: '點擊任一色塊 → 查看適用例程' } },
                scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } },
                onClick: (e, elements) => {
                    if (elements[0]) {
                        const datasetIndex = elements[0].datasetIndex;
                        const stageLabels = ['課前', '課中', '課後'];
                        const stage = stageLabels[datasetIndex];
                        showRoutinesByStage(stage);
                    }
                }
            }
        });

        // 切換圖表
        function showChart(type) {
            document.querySelectorAll('.chart-container').forEach(c => c.classList.remove('active'));
            document.getElementById(type).classList.add('active');
            document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('searchResults').style.display = 'none';
        }

        // 顯示按類別
        function showRoutinesByCategory(category) {
            const list = routines.filter(r => r.category === category);
            showModal(`${category}（共 ${list.length} 個）`, list);
        }

        // 顯示按階段
        function showRoutinesByStage(stage) {
            const list = routines.filter(r => r.stage.includes(stage));
            showModal(`${stage}適用例程（共 ${list.length} 個）`, list);
        }

        // 彈出視窗
        function showModal(title, list) {
            document.getElementById('modalTitle').textContent = title;
            const body = document.getElementById('modalBody');
            body.innerHTML = list.map(r => `
                <div class="routine-item">
                    <strong>${r.name}</strong><br>
                    <small>問句數：${r.questions} ｜ 階段：${r.stage}</small>
                </div>
            `).join('');
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // 搜尋功能
        function filterRoutines() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            const results = routines.filter(r => r.name.toLowerCase().includes(query));
            const container = document.getElementById('searchResults');
            const list = document.getElementById('resultsList');

            if (query === '') {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            if (results.length === 0) {
                list.innerHTML = '<div class="no-data">無匹配結果</div>';
            } else {
                list.innerHTML = `<p>找到 ${results.length} 個結果：</p>` + results.map(r => `
                    <div class="routine-item">
                        <strong>${r.name}</strong>（${r.category}）<br>
                        <small>問句數：${r.questions} ｜ 階段：${r.stage}</small>
                    </div>
                `).join('');
            }
        }

        // 點擊外部關閉
        window.onclick = function(e) {
            const modal = document.getElementById('modal');
            if (e.target === modal) closeModal();
        }
    </script>
</body>
</html>
